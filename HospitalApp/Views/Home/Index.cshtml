@{
    ViewData["Title"] = "Trang chủ";
    var doctors = (IEnumerable<HospitalApp.Models.Doctor>)(ViewBag.Doctors ?? Enumerable.Empty<HospitalApp.Models.Doctor>());
    var services = (IEnumerable<HospitalApp.Models.Service>)(ViewBag.Services ?? Enumerable.Empty<HospitalApp.Models.Service>());

    int totalDoctors = ViewBag.TotalDoctors is int td ? td : 0;
    int totalPatients = ViewBag.TotalPatients is int tp ? tp : 0;
    int totalAppts = ViewBag.TotalAppts is int ta ? ta : 0;
}
<!-- Alerts -->
@if (TempData["HomeError"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["HomeError"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}
@if (TempData["HomeWarn"] != null)
{
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        @TempData["HomeWarn"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<!-- Hero -->
<section class="rounded-4 p-5 mb-4" style="
    background: radial-gradient(1200px 600px at 10% 10%, #e9f2ff 0%, transparent 60%),
                radial-gradient(1000px 500px at 90% 90%, #eef7ff 0%, transparent 60%),
                linear-gradient(135deg, #f8fbff 0%, #f1f5ff 100%);
    border: 1px solid #eef2ff;">
    <div class="container">
        <div class="row align-items-center g-4">
            <div class="col-lg-8">
                <h1 class="display-6 fw-semibold text-primary mb-3">Đặt lịch khám nhanh – Quản lý hồ sơ tiện lợi</h1>
                <p class="fs-5 text-secondary mb-4">
                    Chọn bác sĩ, chọn dịch vụ, chọn thời gian phù hợp — xác nhận trong 1 bước.
                </p>
                <div class="d-flex flex-wrap gap-2">
                    <a class="btn btn-primary btn-lg px-4" asp-controller="Appointments" asp-action="Create">
                        Đặt lịch ngay
                    </a>
                    <a class="btn btn-outline-primary btn-lg px-4" asp-controller="Catalog" asp-action="Doctors">
                        Xem danh sách bác sĩ
                    </a>
                    <a class="btn btn-outline-secondary btn-lg px-4" asp-controller="Catalog" asp-action="Services">
                        Xem dịch vụ
                    </a>
                </div>
            </div>
            <div class="col-lg-4">
                <!-- Stats mini-cards -->
                <div class="row g-3">
                    <div class="col-12">
                        <div class="card shadow-sm border-0">
                            <div class="card-body d-flex justify-content-between align-items-center">
                                <div>
                                    <div class="text-muted">Tổng bác sĩ</div>
                                    <div class="fs-3 fw-bold">@totalDoctors</div>
                                </div>
                                <span class="badge bg-primary-subtle text-primary rounded-pill px-3 py-2">Đội ngũ</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="card shadow-sm border-0">
                            <div class="card-body d-flex justify-content-between align-items-center">
                                <div>
                                    <div class="text-muted">Tổng bệnh nhân</div>
                                    <div class="fs-3 fw-bold">@totalPatients</div>
                                </div>
                                <span class="badge bg-success-subtle text-success rounded-pill px-3 py-2">Tin cậy</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="card shadow-sm border-0">
                            <div class="card-body d-flex justify-content-between align-items-center">
                                <div>
                                    <div class="text-muted">Tổng lịch hẹn</div>
                                    <div class="fs-3 fw-bold">@totalAppts</div>
                                </div>
                                <span class="badge bg-info-subtle text-info rounded-pill px-3 py-2">Hiệu quả</span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /stats -->
            </div>
        </div>
    </div>
</section>

<!-- Doctors -->
<section class="mb-5">
    <div class="d-flex align-items-center justify-content-between mb-3">
        <h3 class="m-0">Bác sĩ nổi bật</h3>
        <a asp-controller="Catalog" asp-action="Doctors" class="btn btn-sm btn-outline-primary">Xem tất cả</a>
    </div>

    @if (!doctors.Any())
    {
        <div class="alert alert-light border">Chưa có bác sĩ để hiển thị.</div>
    }
    else
    {
        <div class="row g-3">
            @foreach (var d in doctors)
            {
                <div class="col-12 col-sm-6 col-lg-4">
                    <div class="card h-100 shadow-sm border-0">
                        <div class="card-body">
                            <div class="d-flex align-items-start justify-content-between">
                                <div>
                                    <h5 class="card-title mb-1">@d.FullName</h5>
                                    <div class="small text-muted">
                                        @if (d.Position != null)
                                        {
                                            @d.Position.Name
                                        }
                                        @if (d.Expertise != null)
                                        {
                                            @($" · {d.Expertise.Name}")
                                        }
                                    </div>
                                </div>
                                <span class="badge bg-primary-subtle text-primary">#@d.Id</span>
                            </div>

                            @if (!string.IsNullOrWhiteSpace(d.PhoneNumber))
                            {
                                <div class="mt-2 small text-secondary">SĐT: @d.PhoneNumber</div>
                            }

                            <div class="mt-3 d-flex gap-2">
                                <a class="btn btn-sm btn-outline-primary"
                                   asp-controller="Catalog" asp-action="Doctors">
                                    Xem danh sách
                                </a>
                                <a class="btn btn-sm btn-primary"
                                   asp-controller="Appointments" asp-action="Create">
                                    Đặt lịch
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</section>

<!-- Services -->
<section class="mb-4">
    <div class="d-flex align-items-center justify-content-between mb-3">
        <h3 class="m-0">Dịch vụ phổ biến</h3>
        <a asp-controller="Catalog" asp-action="Services" class="btn btn-sm btn-outline-secondary">Xem tất cả</a>
    </div>

    @if (!services.Any())
    {
        <div class="alert alert-light border">Chưa có dịch vụ để hiển thị.</div>
    }
    else
    {
        <div class="row g-3">
            @foreach (var s in services)
            {
                <div class="col-12 col-sm-6 col-lg-4">
                    <div class="card h-100 shadow-sm border-0">
                        <div class="card-body">
                            <div class="d-flex align-items-start justify-content-between">
                                <h5 class="card-title mb-1">@s.Name</h5>
                                <span class="badge bg-light text-secondary border">@($"#{s.Id}")</span>
                            </div>
                            <div class="small text-muted mb-2">
                                @(s.MedicalDepartment?.Name ?? "—")
                            </div>
                            <div class="fw-semibold mb-3">Giá: @s.Price.ToString("N0") VNĐ</div>

                            <div class="d-flex gap-2">
                                <a class="btn btn-sm btn-outline-secondary"
                                   asp-controller="Catalog" asp-action="Services">
                                    Xem dịch vụ
                                </a>
                                <a class="btn btn-sm btn-primary"
                                   asp-controller="Appointments" asp-action="Create">
                                    Đặt lịch
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</section>
